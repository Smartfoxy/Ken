<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ken_Ken</title>
    <style>
        .container {
            width: 800px;
            height: 800px;
            background-color: lightblue;
            margin: 50px auto;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        .table {
            border: 1px solid blue;
            padding: 15px;
        }
        td {
            border: 1px solid blue;
            padding: 5px;
            height: 20px;
            width: 20px;
            text-align: center;
        }
        table {
            border-collapse: collapse;
        }
        ._0 {
            background-color: red;
        }
        ._1 {
            background-color: yellow;
        }
        ._2 {
            background-color: green;
        }
        ._3 {
            background-color: blue;
        }
        ._4 {
            background-color: orange;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="table">
            <table></table>
        </div>
        
    </div>

    <script>
        "use strict"

        
        
        class Cell {
            constructor(row, col) {
                this.row = row;
                this.col = col;
                this.fill = false;
            }
            fillNum(num) {
                this.num = num;
                this.fill = true;
            }
        }

        let repeate = 0; 

        const num = 5;
        let kenArr = createKen(num);
        fillKen(kenArr);

        console.log(kenArr);
        
        drawTable(kenArr);

        //console.log(repeate);

        const $table = document.querySelector('table');
        //console.log($table);
        unionCells($table, kenArr);






        function unionCells($table, arrOfCells) {
            for(let i = 0 ; i < 1/*$table.length*/; i++) {
                for(let j = 0; j < 5/*$table.rows[i].length*/; j++) {
                    console.log('J: ', j);
                    let x = i;
                    let y = j;
                    if($table.rows[x].cells[y].classList.contains('union')){
                        continue;
                    }
                    for(let z = 0; z < 3/*random*/;z++) {
                        

                        if(z !== 0) {
                            let direction = isOnRight();
                            const nextCell = $table.rows[x + !direction].cells[y + direction];
                            if(!nextCell || nextCell.classList.contains('union')){
                                direction = !direction;
                            }
                            x += !direction;
                            y += direction; 
                        }


                        $table.rows[x].cells[y].className = `union _${j}`;

                        console.log('X: ' + x, 'Y: ' + y, $table.rows[x].cells[y].className);

                        if(!isNeighborCellExist($table, x, y) || !isNeighborCellNotUnion($table, x, y)) {
                            console.log('break');
                            break;
                        }

                    }
                   
                }
            }
        }
        function isOnRight() {
            let y = Math.round(Math.random());
            console.log(y);
            return y; //Math.round(Math.random());
        }
        function isCellExist($table, x, y) {
            return $table.rows[x].cells[y];
        }
        function isNeighborCellExist($table, x, y) {
            return isCellExist($table, x + 1, y) ||/* isCellExist($table, x - 1, y) ||*/ isCellExist($table, x, y + 1)/* || isCellExist($table, x, y - 1)*/;
        }
        function isCellNotUnion($table, x, y) {
            return !$table.rows[x].cells[y].classList.contains('union');
        }
        function isNeighborCellNotUnion($table, x, y) {
            return isCellNotUnion($table, x + 1, y) ||/* isCellNotUnion($table, x - 1, y) ||*/ isCellNotUnion($table, x, y + 1)/* || isCellNotUnion($table, x, y - 1)*/;
        }

       

        function createKen(num) {
            let kenArr = [];
            for(let i = 0; i < num; i++) {
                let rowArr = [];
                for(let j = 0; j < num; j++) {
                    rowArr.push(new Cell(i, j));
                }
                kenArr.push(rowArr);
            }
            return kenArr;
        }

        function fillKen(kenArr) {
            const length = kenArr.length;
            for(let i = 1; i <= length; i++) {
                console.log("attempt", i);
                
                for(let j = 0; j < length; j++) {
                    let emptyCellInRow = kenArr[j].filter(function(cell) {
                        return !cell.fill;
                    })
                    let restCellForFill = emptyCellInRow.filter(function(el) {
                        let result = true;
                        for(let z = 0; z < j; z++) {
                            if(kenArr[z][el.col].num === i) result = false;
                        }
                        return result;
                    })
                    console.log('строка ', j, 'length : ', restCellForFill.length);
                    if(!restCellForFill.length) {
                        console.log('пусто');
                        repeate++;
                        for(let z = 0; z < j; z++) {
                            kenArr[z].forEach(el => {
                                if(el.num === i) {
                                    el.num = null;
                                    el.fill = false;
                                }
                            });
                        }

                        j = -1;
                        continue;
                    }   
                    /*console.log('string #', j);
                    emptyCellInRow.forEach(el => {
                        console.log(el.col);
                    });
                    console.log('rest #', j)
                    restCellForFill.forEach(el => {
                        console.log(el.col);
                    });*/
                    //console.log(j, restCellForFill);
                    let col = Math.round(Math.random() * (restCellForFill.length - 1));
                    let currentCell = restCellForFill[col];
                    currentCell.fillNum(i);
                    for(let i = 0; i < length; i++) {
                        let result = '';
                        for(let j = 0; j < length; j++){
                            let cur = kenArr[i][j].num ? kenArr[i][j].num : 0;
                            result += cur + " ";
                        }
                        console.log(result); 
                    }
                    //console.log(currentCell.row, currentCell.col, currentCell.num);
                }

            }
        }

        


        

        

        function drawTable(arrObj) {
            const $table = document.querySelector('table');
            let inner = '';
            for(let i = 0; i < arrObj.length; i++) {
                let row = '<tr>';
                    for(let j = 0; j < arrObj[i].length; j++) {
                        row += `<td class = 'cell'>${arrObj[i][j].num}</td>`;
                    }
                row += '</tr>';    
                inner += row;
            }

            $table.innerHTML = inner;
        }



        //let cell = new Cell(5);
       // cell.sayNum();


        /*for(let i = 0; i < num; i++) {
            let cell = new Cell(Math.round(Math.random() * (num - 1) + 1));
            arr.push(cell);
        }*/

        



        
       /* const arr = createArr(num);
        drawTable(arr);

        console.log(arr);


        function createArr(num) {
            let arr = [];
            for(let i = 0; i < num; i++) {
                let row = [];
                for(let j = 0; j < num; j++) {
                    let col = [];
                    for(let z = 0; z < i; z++) {
                        col.push(arr[z][j]);
                    }
                    console.log('col : ' , i, j, col);
                    console.log('row : ' , i, j, row);
                    console.log(arr);

                    let rand;
                    do {
                        rand = Math.round(Math.random() * (num - 1) + 1);
                        console.log(i, j , '*', rand);
                    } while (isNumInArray(rand, row)|| isNumInArray(rand, col)); //;

                    row.push(rand);
                }
                arr.push(row);
            }
            return arr;
        }

        function isNumInArray(num, array) {
            let result = false;
            for(let i = 0; i < array.length; i++){
                if (num === array[i]) result = true;
            }
            return result;
        }
        function drawTable(arr) {
            const $table = document.querySelector('table');
            let inner = '';
            for(let i = 0; i < arr.length; i++) {
                let row = '<tr>';
                    for(let j = 0; j < arr[i].length; j++) {
                        row += `<td class = 'cell'>${arr[i][j]}</td>`;
                    }
                row += '</tr>';    
                inner += row;
            }

            $table.innerHTML = inner;
        }

        */

        

    </script>

    
</body>
</html>